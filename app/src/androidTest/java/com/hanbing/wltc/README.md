# 在线弹窗系统测试文档

本测试套件用于测试应用中的在线弹窗功能，包括其配置加载、安全系统集成以及各种异常情况的处理。

## 测试结构

测试代码组织如下：

- `TestSuite.java` - 主测试套件，集成了所有测试类
- `FullPopupSystemTest.java` - 完整弹窗功能和安全系统集成测试
- `OnlineDialogLoadingTest.java` - 弹窗加载和异步处理能力测试
- `DialogMockUtils.java` - 测试辅助工具类，提供模拟网络连接等功能

## 测试内容

### 基础功能测试
- 弹窗正常显示
- 弹窗内容正确解析
- 弹窗按钮点击事件

### 网络和配置测试
- 网络错误情况下的弹窗行为
- 无效配置情况下的弹窗行为
- 配置缓存机制
- URL故障转移机制

### 性能和多线程测试
- 多线程并发调用弹窗的稳定性
- 生命周期事件处理

### 系统集成测试
- 与安全系统的兼容性
- 弹窗异步加载机制

## 如何运行测试

### 方法一：通过Android Studio运行

1. 打开Android Studio
2. 右键点击`TestSuite.java`文件
3. 选择"Run 'TestSuite'"

### 方法二：通过命令行运行

使用以下命令执行测试：

```bash
./gradlew connectedAndroidTest
```

或者针对特定测试类运行：

```bash
./gradlew connectedAndroidTest -Pandroid.testInstrumentationRunnerArguments.class=com.hanbing.wltc.FullPopupSystemTest
```

## 测试环境要求

- Android SDK 版本：28+
- 测试设备：支持任何真实设备或模拟器
- 网络权限：测试需要网络权限模拟在线配置获取

## 注意事项

1. 测试使用了模拟HTTP连接，不会实际连接到服务器，因此不依赖于实际的网络环境
2. 测试可能需要一定时间等待弹窗显示，请耐心等待
3. 如果测试失败，请查看日志输出以获取详细信息

## 测试结果解读

测试成功完成后，您将在终端或Android Studio的运行窗口中看到成功信息。任何测试失败都会提供详细的错误信息，帮助您定位问题。 
使用Gradle命令运行测试：

```bash
# 运行所有测试
./gradlew connectedAndroidTest

# 运行单个测试类
./gradlew connectedAndroidTest -PandroidTest.includeCategory=com.hanbing.wltc.IntegrationTestRunner
```

### 方法3: 使用测试应用菜单

1. 安装测试应用到设备上
2. 打开测试应用
3. 点击"运行测试"按钮
4. 等待测试完成并查看结果

## 测试结果查看

测试执行后，结果将通过以下方式呈现：

1. **控制台输出**: 测试过程和结果会实时输出到控制台
2. **测试报告文件**: 详细的测试报告保存在设备的外部存储中
   - 路径通常为：`/storage/emulated/0/Android/data/{package_name}/files/Documents/test_report_*.txt`
3. **Android Studio测试报告**: 在Android Studio中可以查看图形化的测试结果报告

## 测试结果解读

测试报告中将包含以下信息：

- **测试环境信息**: 设备型号、Android版本、应用版本等
- **测试结果概览**: 测试总数、通过数、失败数、跳过数
- **弹窗功能测试结果**: 弹窗显示、交互和样式测试结果
- **安全系统测试结果**: 加密解密、设备绑定等安全功能测试结果
- **集成测试结果**: 两个系统并行运行的集成测试结果

## 测试状态说明

测试报告中的状态标识：

- **[✓]**: 测试通过
- **[✗]**: 测试失败
- **[!]**: 测试跳过

## 常见问题排查

### 无法显示弹窗

可能原因：
- 权限问题：确保应用有显示弹窗的权限
- 主线程阻塞：检查是否在UI线程上显示弹窗
- 配置问题：检查弹窗配置是否正确

### 安全系统测试失败

可能原因：
- 缺少安全组件：检查安全系统的库是否正确集成
- 权限问题：某些安全功能可能需要特定权限
- 设备兼容性：某些安全特性可能在特定设备上不支持

### 测试超时

可能原因：
- 网络问题：如果测试涉及网络请求，可能因网络问题超时
- 设备性能：低端设备可能处理速度较慢
- 线程同步问题：并行测试可能存在同步问题

## 联系与支持

如果遇到测试问题或需要支持，请联系开发团队。 